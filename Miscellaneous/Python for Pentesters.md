# Python for Pentesters
Python can be a powerful tool in the arsenal as it can be used build amost any of the other penetration testing tools.

### Subdomain enumeration
```python

import requests 
import sys 

sub_list = open("subdomains.txt").read() 
subdoms = sub_list.splitlines()

for sub in subdoms:
    sub_domains = f"http://{sub}.{sys.argv[1]}" 

    try:
        requests.get(sub_domains)
    
    except requests.ConnectionError: 
        pass
    
    else:
        print("Valid domain: ",sub_domains)  
         
```

### Directory enumeration
```python

import requests 
import sys 

sub_list = open("wordlist.txt").read() 
directories = sub_list.splitlines()

for dir in directories:
    dir_enum = f"http://{sys.argv[1]}/{dir}.html" 
    r = requests.get(dir_enum)
    if r.status_code==404: 
        pass
    else:
        print("Valid directory:" ,dir_enum)
```

### Network Scanner
Python can be used to build a simple ICMP scanner to identify potential targets on the network. However, ICMP packets can be monitored or blocked as the target organization would not expect a regular user to "ping a server". On the other hand, systems can be configured to not respond to ICMP requests. These are the main reasons why using ARP to identify on the network is more effective.

```python
from scapy.all import *

interface = "eth0"
ip_range = "10.10.X.X/24"
broadcastMac = "ff:ff:ff:ff:ff:ff"

packet = Ether(dst=broadcastMac)/ARP(pdst=ip_range)

ans, unans = srp(packet, timeout=2, iface=interface, inter=0.1)

for send, receive in ans:
	print(receive.sprintf(r"%Ether.src% - %ARP.psrc%"))
```


### Port Scanner
```python
import sys
import socket
import pyfiglet


ascii_banner = pyfiglet.figlet_format("TryHackMe \n Python 4 Pentesters \nPort Scanner")
print(ascii_banner)


ip = '192.168.1.6' 
open_ports =[] 

ports = range(1, 65535)


def probe_port(ip, port, result = 1): 
  try: 
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
    sock.settimeout(0.5) 
    r = sock.connect_ex((ip, port))   
    if r == 0: 
      result = r 
    sock.close() 
  except Exception as e: 
    pass 
  return result


for port in ports: 
    sys.stdout.flush() 
    response = probe_port(ip, port) 
    if response == 0: 
        open_ports.append(port) 
    

if open_ports: 
  print ("Open Ports are: ") 
  print (sorted(open_ports)) 
else: 
  print ("Looks like no ports are open :(")


```

### File Downloader
`wget` or `certutil` on Windows are useful tools to download files

Python can also be used to achieve the same purpose:

```python
import requests
import sys

url = sys.argv[1]
r = requests.get(url, allow_redirects=True)
open('file', 'wb').write(r.content)

```

### Hash Cracker
A hash is often used to safeguard passwords and other important data, or checking data integrity. Python has a library `hashlib`

```python
import hashlib
import pyfiglet

ascii_banner = pyfiglet.figlet_format("HASH CRACKER")
print(ascii_banner)

wordlist_location = str(input('Enter wordlist location: '))
hash_input = str(input('Input hash to crack: '))

with open(wordlist_location, 'r') as file:
	for line in file.readlines():
		hash_ob = hashlib.md5(line.strip().encode())
		hashed_pass = hash_ob.hexdigest()
		if hashed_pass == hash_input:
			print("Found cleartext password! " + line.strip())
			exit(0)

```

### Keyloggers
Modules allow us to solve relatively difficult problems in a simple way.

A good example is the "keyboard" module, which allows us to interact with the keyboard.

If the "keyboard" module is not available, it can be installed using:
`pip3 install keyboard`

```python
import keyboard
keys = keyboard.record(until='ENTER')
keyboard.play(keys)
```

"keyboard.record" will record the keys until ENTER is pressed, and "keyboard.play" will erplay them. As this script is logging keystrokes, any edit using backspace will also be seen.

### SSH brute forcing
The powerful Python language is supported by a number of modules that easily extend its capabilities. Paramiko is an SSHv2 implementation that will useful in building SSH clients and servers.

The example below shows one way to build an SSH password brute force attack script. As is often the case in programming, there rarely is a single correct answer for these kinds of applications. As a pentester, your usage of programming languages will be dfiferent for developers. While they may care about best practices and code hygiene, your goal will often be to end with a code that works the way you want it to.

